name: ğŸš€ Deploy Landing Page

on:
  push:
    branches:
      - main
    paths-ignore:
      - '**.md'
  workflow_dispatch:

env:
  AWS_REGION: us-east-1
  S3_BUCKET: oaprova-landing
  CLOUDFRONT_DISTRIBUTION_ID: E3BQAGME5BZWN9

permissions:
  id-token: write
  contents: read

jobs:
  deploy:
    name: ğŸ—ï¸ Build and Deploy
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: ğŸ“¦ Install dependencies
        run: npm ci

      - name: ğŸ”¨ Build
        run: npm run build

      - name: ğŸ” Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@v4
        with:
          role-to-assume: arn:aws:iam::365183982297:role/GitHubActionsRole
          aws-region: ${{ env.AWS_REGION }}

      - name: â˜ï¸ Deploy to S3
        run: aws s3 sync dist/ s3://${{ env.S3_BUCKET }} --delete

      - name: ğŸ”„ Invalidate CloudFront cache
        run: |
          aws cloudfront create-invalidation \
            --distribution-id ${{ env.CLOUDFRONT_DISTRIBUTION_ID }} \
            --paths "/*"

      - name: âœ… Deploy complete
        run: |
          echo ""
          echo "=========================================="
          echo "ğŸ‰ Deploy realizado com sucesso!"
          echo "=========================================="
          echo ""
          echo "ğŸŒ URLs disponÃ­veis:"
          echo ""
          echo "   â€¢ https://oaprova.com.br"
          echo "   â€¢ https://www.oaprova.com.br"
          echo ""
          echo "=========================================="
